<div class="editor-container">
    <!-- Room Info Header -->
    <div class="room-header">
      <h2>{{ currentRoom?.roomName || 'Collaborative Code Editor' }}</h2>
      <span class="room-id">Room: {{ currentRoomId }}</span>
      <button class="btn-new-room" (click)="newRoom()">New Room</button>
      <button class="btn-share-room" (click)="shareRoom()">
        Share Room
      </button>
      <span class="flex-spacer"></span>
      <button (click)="toggleRoomList()">Rooms ▼</button>
  
      <div *ngIf="showRoomList" class="room-list-dropdown">
        <div *ngFor="let userRoom of userRooms" [class.active]="userRoom.room.roomId === currentRoomId" class="room-list-item">
          <span (click)="switchRoom(userRoom.room)">
            {{ userRoom.room.roomName }} ({{ userRoom.room.roomId }})
          </span>
          <button *ngIf="!userRoom.createdByUser" (click)="leaveRoom(userRoom); $event.stopPropagation()">Leave</button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <h3>Setting up your workspace...</h3>
      <p>Creating room and loading files</p>
    </div>

    <!-- Main Editor (shown when not loading) -->
    <div class="editor-main" *ngIf="!isLoading">
      <!-- File Tree Panel -->
      <div class="file-tree">
        <div class="file-tree-header">
          <h3>Files</h3>
          <button (click)="showCreateFileDialog = true" class="btn-new-file">+ New File</button>
        </div>
        
        <!-- File List -->
        <ul class="file-list">
          <li *ngFor="let file of files" 
              (click)="openFile(file)"
              [class.active]="currentFile?.id === file.id"
              class="file-item">
            <span class="file-name">{{ file.fileName }}</span>
            <button (click)="deleteFile(file.id, $event)" class="btn-delete">×</button>
          </li>
        </ul>

        <!-- Empty state when no files -->
        <div *ngIf="files.length === 0" class="empty-files">
          <p>No files yet</p>
          <small>Create your first file to get started</small>
        </div>
      </div>
      
      <!-- Editor Panel -->
      <div class="editor-panel">
        <div class="editor-header" *ngIf="currentFile">
          <span class="current-file">{{ currentFile.fileName }}</span>
          <span class="file-language">{{ currentFile.language }}</span>
          <button (click)="saveFile()" class="btn-save" [disabled]="!isFileModified">Save</button>
        </div>

        <ngx-monaco-editor 
          *ngIf="currentFile"
          [options]="editorOptions" 
          [(ngModel)]="currentContent"
          (ngModelChange)="onContentChange($event)"
          (onInit)="onEditorInit($event)"
          class="monaco-editor">
        </ngx-monaco-editor>

        <!-- Placeholder when no file selected -->
        <div *ngIf="!currentFile" class="no-file-selected">
          <h3>Welcome to your collaborative workspace!</h3>
          <p>Create a file to start coding</p>
        </div>
      </div>
    </div>

    <!-- Create File Dialog -->
    <div class="modal" *ngIf="showCreateFileDialog" (click)="closeCreateFileDialog($event)">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h3>Create New File</h3>
        <form (ngSubmit)="createNewFile()" #createFileForm="ngForm">
          <div class="form-group">
            <label for="fileName">File Name:</label>
            <input 
              type="text" 
              id="fileName"
              [(ngModel)]="newFileName" 
              name="fileName"
              placeholder="e.g., main.cpp, script.js, index.html"
              required>
            <small class="file-hint">Include the file extension to enable syntax highlighting</small>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-create" [disabled]="!newFileName">Create</button>
            <button type="button" (click)="showCreateFileDialog = false" class="btn-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

        <!-- Join Room Dialog -->
    <div class="modal" *ngIf="showJoinRoomDialog">
      <div class="modal-content">
        <h3>Join Room?</h3>
        <p>Do you want to join this room: <b>{{ pendingJoinRoomId }}</b>?</p>
        <div class="form-actions">
          <button class="btn-create" (click)="joinPendingRoom()">Yes, Join</button>
          <button class="btn-cancel" (click)="cancelJoinRoom()">No</button>
        </div>
      </div>
    </div>
  </div>